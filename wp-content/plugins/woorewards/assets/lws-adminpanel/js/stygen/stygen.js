(function(b){b.widget("lws.lws_css_editor",{_create:function(){this.cssValues=lwsBase64.toObj(this.element.data("cssvalues"));this.defaultValues=lwsBase64.toObj(this.element.data("dftvalues"));this.menuTable={};this.cssObject={};this.miscValues={};this.cssChain="";this._createCssObject(this.cssValues);this._createMaster();this._addBackgroundSwitcher();this._setCssEditor();var a=this.element.find(".lwss_centraldiv");this.popupShadow=b("<div>").addClass("lwss-popup-shadow").appendTo(a);this.element.on("mouseover",".lwss_menu_selector",this._bind(this._overSelector,this));this.element.on("mouseover",".lwss_selector",this._bind(this._overSelector,this));this.element.on("mouseout",".lwss_menu_selector",this._bind(this._outSelector,this));this.element.on("mouseout",".lwss_selector",this._bind(this._outSelector,this));this.element.on("click",".lwss_menu_selector",this._bind(this._clickSelector,this));this.element.on("click",".lwss_selector",this._bind(this._clickSelector,this));this.element.on("click",".lwss-main-conteneur",this._bind(this._clickEditor,this));this.element.on("click",".lwss-sidemenu",this._bind(this._clickEditor,this));this.element.on("click",".lwss-btvisual",this._bind(this._switchToVisual,this));this.element.on("click",".lwss-btcss",this._bind(this._switchToCss,this));this.element.on("click",".lwss-reset",this._bind(this._resetCss,this));this.myStylingPanel=b("<div>").addClass("lwss_styling_panel").prependTo(a);this.myStylingPanel.lws_styling_panel({stygen:this});this._createCssResetList();this.makeCssChain()},_bind:function(a,d){return function(){return a.apply(d,arguments)}},_createMaster:function(){var a=this;this.masterObject={};var d=this.element.find(".lwss_sidemenu");this.element.find(".lwss-visual-conteneur").find(".lwss_selectable").each(function(){var l=b(this);var k="."+l.attr("class").split(" ").join(".");var c=a._createSelector(l,k);var j={Selectable:l,Selector:c,Class:k,Over:"no",Active:"no"};if(a.masterObject[k]==undefined){a.masterObject[k]={};a.masterObject[k].elements=[];a.masterObject[k].cssValues=(a.cssObject[k]!=undefined)?a.cssObject[k]:{idle:{}};if(a.cssObject[k]==undefined){a.cssObject[k]=a.masterObject[k].cssValues}var m=(k.search("lwss_modify")!=-1)?"<div class='lwss_menu_selector_icon lws-icon-quill'></div>":"";m+="<div class='lwss_menu_selector_text'>"+l.data("type")+"</div>";a.masterObject[k].menuItem=b("<div>").addClass("lwss_menu_selector").data("theClass",k).html(m).appendTo(d)}a.masterObject[k].elements.push(j)})},_createCssResetList:function(){var a=this;this.cssResetList={};this.myStylingPanel.find(".lwss_value").each(function(){a.cssResetList[b(this).data("css")]=""})},_setCssEditor:function(){this.cssConteneur=this.element.find(".lwss-css-conteneur");this.cssConteneur.find(".lwss-css-editor").append(b("<textarea>",{"class":"lwss-css-textarea",id:"lwss-cssta-"+this.uuid}))},_switchToVisual:function(a,f){var e=this.element.find(".lwss-btvisual");if(e.hasClass("lws-active")){return}else{this.myStylingPanel.lws_styling_panel("resetActiveValues");this.element.find(".lwss-btcss").removeClass("lws-active");e.addClass("lws-active");this.element.find(".lwss-visual-conteneur").css("display","flex");this.element.find(".lwss-css-conteneur").css("display","none");this.cssEditor.codemirror.off()}},_switchToCss:function(h,g){var k=this.element.find(".lwss-btcss");if(k.hasClass("lws-active")){return}else{this.element.find(".lwss-btvisual").removeClass("lws-active");k.addClass("lws-active");this.element.find(".lwss-css-conteneur").css("display","flex");this.element.find(".lwss-visual-conteneur").css("display","none");if(!this.cssEditor){this.cssEditor=wp.codeEditor.initialize(this.cssConteneur.find("#lwss-cssta-"+this.uuid),cm_settings)}this.makeCssChain();this.cssEditor.codemirror.setValue(this.cssChain);var j=this;var a;this.cssEditor.codemirror.on("keyup",function(){clearTimeout(a);a=setTimeout(j._bind(j._editorCssChanged,j),"1000")});this.cssEditor.codemirror.on("keydown",function(){clearTimeout(a)})}},_overSelector:function(a,h){var f=b(a.currentTarget).data("theClass");var g=this.masterObject[f];g.menuItem.addClass("lwss_over_msel");for(let i=0;i<g.elements.length;i++){g.elements[i].Selector.addClass("lwss_over_sel")}},_outSelector:function(a,h){var f=b(a.currentTarget).data("theClass");var g=this.masterObject[f];g.menuItem.removeClass("lwss_over_msel");for(let i=0;i<g.elements.length;i++){g.elements[i].Selector.removeClass("lwss_over_sel")}},_createSelector:function(a,f){if(a.prop("nodeName")=="INPUT"||(a.prop("nodeName")=="TEXTAREA")){if(a.attr("type")=="password"){a.prop("disabled",true)}var h=a.parent();var g=b("<div>",{"class":"lwss_wrapper"}).appendTo(h);a.detach().appendTo(g);theSelector=b("<div>",{"class":"lwss_selector lwss_inp_sel"}).data("theClass",f).appendTo(g)}else{theSelector=b("<div>",{"class":"lwss_selector"}).data("theClass",f).prependTo(a)}return b(theSelector)},_addBackgroundSwitcher:function(){var a=this.element.find(".lwss-main-conteneur");var f=b("<div>").addClass("lws-bg-switcher").appendTo(a);var g=b("<div>").addClass("lws-white-switcher").appendTo(f);g.click(function(){a.css("background","#ffffff")});var h=b("<div>").addClass("lws-black-switcher").appendTo(f);h.click(function(){a.css("background","#000000")})},placeSelectors:function(){this.element.find(".lwss_inp_sel").each(function(){var d=b(this);var a=d.parent().find(".lwss_selectable");d.outerWidth(a.outerWidth(true)+4).outerHeight(a.outerHeight(true)+4);d.css("top",a.position().top-2).css("left",a.position().left-2)})},_clickSelector:function(j){this.element.find(".lwss_selector").removeClass("lwss_sel_sel");this.element.find(".lwss_menu_selector").removeClass("lwss_sel_msel");var g=b(j.currentTarget).data("theClass");var h=this.masterObject[g];h.menuItem.addClass("lwss_sel_msel");for(let i=0;i<h.elements.length;i++){h.elements[i].Selector.addClass("lwss_sel_sel")}var k=this.masterObject[g].elements[0].Selectable;var a=(k.data("id")!="")?k.data("id"):"";this.element.find(".lwss_info").hide();this.myStylingPanel.lws_styling_panel("openStylingPanel",g,a);this.myStylingPanel.show()},_clickEditor:function(d){var a=(b(d.target).hasClass("lwss_menu_selector_text")||b(d.target).hasClass("lwss_menu_selector_text"))?b(d.target.parentElement):b(d.target);if(!a.hasClass("lwss_selector")&&!a.hasClass("lwss_menu_selector")){this.element.find(".lwss_selector").removeClass("lwss_sel_sel");this.element.find(".lwss_menu_selector").removeClass("lwss_sel_msel");this.myStylingPanel.lws_styling_panel("setEvent","idle");this.element.find(".lwss_styling_panel").hide();this.element.find(".lwss_info").show()}},_updateMaster:function(){var a=this;b.each(this.cssObject,function(e,f){b.each(f,function(d,c){if(a.masterObject[e]!=undefined){a.masterObject[e].cssValues[d]=c}})})},_resetCss:function(){this.cssObject={};this._createCssObject(this.defaultValues);this._updateMaster();this._applyCssObject();this.makeCssChain();if(this.cssEditor!=undefined){this.cssEditor.codemirror.setValue(this.cssChain)}},_editorCssChanged:function(){var u=this.cssConteneur.find(".CodeMirror-lint-marker-error").length;if(u==0&&this.cssEditor!=undefined){this._cleanStyleObjects();var o=this.cssEditor.codemirror.getValue();var r=o.replace(/(?:\r\n|\r|\n|\t)/g,"");r=r.split("}");for(var s=0;s<r.length;s++){if(r[s]!=""){var a=r[s].split("{");var j=a[0].split(":");var v=j[0].trim();var p=(j[1]==undefined)?"idle":j[1].trim();var w=a[1].split(";");var q={};for(var t=0;t<w.length;t++){if(w[t].indexOf(":")!=-1){q[w[t].split(":")[0].trim()]=w[t].split(":")[1].trim()}}this.cssObject[v]={};this.cssObject[v][p]=q}}this._updateMaster();this._applyCssObject();this.makeCssChain()}},_applyCssObject:function(){b.each(this.cssObject,function(d,a){b.each(a,function(f,c){lwssCanvas.find(d).css(c)})})},_cleanStyleObjects:function(){b.each(this.masterObject,function(d,a){a.cssValues={}});this.cssObject={}},_createCssObject:function(d){var a=this;lwssCanvas=this.element;b.each(d,function(l,j){var m=(j.Selector.split(":"))[0];var c=((j.Selector.split(",")[0].split(":"))[1]!=undefined)?(j.Selector.split(",")[0].split(":"))[1]:"idle";var k=(a.cssObject[m]!=undefined)?a.cssObject[m]:{};k[c]=j.Defaults;if(j.Values!=null&&j.Values!=undefined&&!Array.isArray(j.Values)){k[c]=j.Values}a.cssObject[m]=k;lwssCanvas.find(j.Selector).css(j.Defaults);lwssCanvas.find(j.Selector).css(j.Values)})},makeCssChain:function(){lwssCanvas=this.element;this.cssChain="";var d=this;var a=this.element.find(".lwss_editor_chain");b.each(this.cssObject,function(c,f){b.each(f,function(h,e){if(e!=""){if(h=="idle"){d.cssChain+=c+"{"}else{if(h=="hover"){d.cssChain+=c+":hover, "+c+".hovered{"}else{if(h=="focus"){d.cssChain+=c+":focus, "+c+".focused{"}}}b.each(e,function(g,k){if(k!=undefined&&k!=""){d.cssChain+=g+":"+k+";"}});d.cssChain+="}\n"}})});a.val(lwsBase64.encode(this.cssChain))}})})(jQuery);jQuery(function(b){b(".lwss_editor").lws_css_editor();b(".lwss_editor").click(function(a){if(b(a.target).closest(".lwss-color-selector-relative").length==0&&b(a.target).closest(".lwss-fontselect-popup").length==0){b(".lwss-popup-shadow").hide()}})});