(function(f){var i=null;var j=null;var h=null;var g=null;f.widget("lws.lwss_fontselect",{options:{icon:"",cssColor:"",properties:["font-family","font-weight"],values:[],api:"https://fonts.googleapis.com/css?family="},_create:function(){this.wrapper=this.element.addClass("lwss-fontselect-wrapper");this.shadow=f("<div>").addClass("lwss-fontselect-shadow").appendTo(this.wrapper);this.left=f("<div>").addClass("lwss-fontselect-left").appendTo(this.wrapper);this.right=f("<div>").addClass("lwss-fontselect-right").appendTo(this.wrapper);this.icon=f("<div>").addClass("lwss-fontselect-icon "+this.options.icon+" "+this.options.cssColor).appendTo(this.left);this.label=f("<div>").addClass("lwss-fontselect-label").html("Font").appendTo(this.right);this.group=f("<div>").addClass("lwss-fontselect-group").appendTo(this.right);this.input=f("<div>").addClass("lwss-fontselect-input").html("Choose a font...").appendTo(this.group);this.inputbtn=f("<div>").addClass("lwss-fontselect-btn lws-icon-select_arrow_down "+this.options.cssColor).appendTo(this.group);this.family=f("<input>").addClass("lwss-fontselect-family lwss_value").data("css",this.options.properties[0]).attr("type","hidden").prependTo(this.wrapper);this.weight=f("<input>").addClass("lwss-fontselect-weight lwss_value").data("css",this.options.properties[1]).attr("type","hidden").prependTo(this.wrapper);this.mainColor=this.inputbtn.css("color");this.activeFont=null;this.rgba=this.mainColor.replace(")",", 0.1)").replace("rgb","rgba");var a=this;this._buildFontLists();this._buildPopUp();this._manageEvents();this._setTab("Fav")},_bind:function(b,a){return function(){return b.apply(a,arguments)}},_chooseFont:function(a){var b=g[f(a.delegateTarget).css("font-family")];this.family.val(b.Name).trigger("change");this.weight.val("normal").trigger("change")},_setFavourite:function(b){if(i==undefined){i=[]}var a=i.indexOf(b.Name);if(a!=-1){i.splice(a,1)}i.unshift(b.Name);if(i.length>=7){i.pop()}localStorage.setItem("lws-favouriteFonts",lwsBase64.fromObj(i))},_setFont:function(a){var b=g[a.delegateTarget.value];if(b!=undefined){this.input.html(b.Name).css("font-family",b.Name);this._setFavourite(b);this.element.closest(".lwss_editor").find(".lwss-popup-shadow").hide();this.popup.hide()}else{this.input.html("Choose a font...").css("font-family","Gravity").css("font-weight","300")}},_setWeight:function(b){var a=f(b.delegateTarget).val();this.input.html(myFont.Name).css("font-weight",a)},_weightTr:function(a){if(lws_adminpanel.fontWeightTr[a.toLowerCase()]!=undefined){return lws_adminpanel.fontWeightTr[a.toLowerCase()]}return a},_selectVariant:function(a){var b=f(a.delegateTarget);this.family.val(b.data("family")).trigger("change");this.weight.val(b.data("weight")).trigger("change")},_showVariants:function(c){f(".lwss-fontselect-variants").remove();var d=this;var a=f(c.delegateTarget);var b=f("<div>",{"class":"lwss-fontselect-variants",style:"display:none;"}).appendTo(a);b.offset({left:(a.offset().left+a.outerWidth()+1),top:a.offset().top});var o=a.data("variants").split(",");for(var n=0;n<o.length;++n){this._addFontLink(a.data("family"),o[n]);var e=f("<div>").addClass("lwss-fontselect-variantline").appendTo(b);e.html(this._weightTr(o[n])).css("font-family",a.data("family")).css("font-weight",o[n]);e.data("family",a.data("family")).data("weight",o[n]);e.mouseover(function(){f(this).addClass(d.options.cssColor)}).mouseout(function(){f(this).removeClass(d.options.cssColor)});e.click(this._bind(this._selectVariant,this))}b.fadeIn()},_setTab:function(a){this.activeTab=a;var b=this;this.element.find(".lwss_fontselect_tsel").each(function(){if(f(this).data("Tab")==b.activeTab){f(this).css("background-color",b.mainColor).css("color","#ffffff")}else{f(this).css("background-color","transparent").css("color","#444444")}});this.element.find(".lwss-fontselect-tab").each(function(){if(f(this).data("Tab")==b.activeTab){f(this).show()}else{f(this).hide()}})},_openPopup:function(){var b=this;this.gglTab.empty();this.stdTab.empty();this.favTab.empty();f.each(g,function(e,d){var c=d.Display;b._setFontEvents(c,b);if(i.indexOf(d.Name)!=-1){c.appendTo(b.favTab)}else{if(d.Type=="Standard Font"){c.appendTo(b.stdTab)}else{c.appendTo(b.gglTab)}}});if(i!=undefined){this._setTab("Fav")}else{this._setTab("Ggl")}var a=this.element.closest(".lwss_editor").find(".lwss-popup-shadow").show();this.popup.show();return false},_showShadow:function(){this.shadow.show()},_hideShadow:function(){this.shadow.hide()},_manageEvents:function(){var a=this;this.element.mouseenter(this._bind(this._showShadow,this));this.element.mouseleave(this._bind(this._hideShadow,this));this.element.focusin(function(){a.shadow.addClass("lwss-active")});this.element.focusout(function(){a.shadow.removeClass("lwss-active")});this.family.change(this._bind(this._setFont,this));this.weight.change(this._bind(this._setWeight,this));this.group.click(this._bind(this._openPopup,this))},_buildPopUp:function(){this.popup=f("<div>").addClass("lwss-fontselect-popup").appendTo(this.right).hide();this.tabSelectors=f("<div>").addClass("lwss-fontselect-tab-selectors").appendTo(this.popup);this.tabs=f("<div>").addClass("lwss-fontselect-tabs").appendTo(this.popup);this._addFavTab();this._addStandardTab();this._addGoogleTab()},_addFavTab:function(){this.favSelector=f("<div>").addClass("lwss-fontselect-fav-selector lwss_fontselect_tsel").data("Tab","Fav").html("My Favourites").appendTo(this.tabSelectors);var a=this;this.favSelector.click(function(){a._setTab(f(this).data("Tab"))});this.favTab=f("<div>").addClass("lwss-fontselect-tab").data("Tab","Fav").appendTo(this.tabs).hide()},_addStandardTab:function(){this.stdSelector=f("<div>").addClass("lwss-fontselect-std-selector lwss_fontselect_tsel").data("Tab","Std").html("Standard Fonts").appendTo(this.tabSelectors);var a=this;this.stdSelector.click(function(){a._setTab(f(this).data("Tab"))});this.stdTab=f("<div>").addClass("lwss-fontselect-tab").data("Tab","Std").appendTo(this.tabs).hide()},_addGoogleTab:function(){this.gglSelector=f("<div>").addClass("lwss-fontselect-ggl-selector lwss_fontselect_tsel").data("Tab","Ggl").html("Google Fonts").appendTo(this.tabSelectors);var a=this;this.gglSelector.click(function(){a._setTab(f(this).data("Tab"))});this.gglTab=f("<div>").addClass("lwss-fontselect-tab").data("Tab","Ggl").appendTo(this.tabs)},_addFontLink:function(c,a){var b=this.options.api+c;if(a!=undefined&&a.length>0){b+=(":"+a)}if(f("link[href='"+b+"']").length===0){f("link:last").after('<link href="'+b+'" rel="stylesheet" type="text/css">')}},_setFontEvents:function(b,c){var a=b.find(".lwss-fontselect-font-title");a.off().click(c._bind(c._chooseFont,c));a.mouseover(function(){f(this).addClass(c.options.cssColor)}).mouseout(function(){f(this).removeClass(c.options.cssColor)});var d=b.find(".lwss-fontselect-variant-btn");d.off().click(c._bind(c._showVariants,c))},_createFontDisplay:function(n,c){var b=f("<div>").addClass("lwss-fontselect-font-container");var a=f("<div>").addClass("lwss-fontselect-font-title").html(n.Name).css("font-family",n.Name).appendTo(b);var d=f("<div>").addClass("lwss-fontselect-font-cat").html(n.Cat).appendTo(b);var e=f("<div>").addClass("lwss-fontselect-font-type").html(n.Type).appendTo(b);if(n.Variants.length>1){var m=f("<div>",{"class":"lwss-fontselect-variant-btn "+((c.options.cssColor!=undefined)?" "+c.options.cssColor:""),html:n.Variants.length+" variants","data-family":n.Name,"data-variants":n.Variants.join(",")}).appendTo(b)}return b},_addStandardFonts:function(){var a=this;for(var b=0;b<j.length;b++){var d={};d.Variants=[];d.Name=j[b].family;d.Cat=j[b].category;d.Type="Standard Font";for(var c=0;c<j[b].variants.length;c++){if(j[b].variants[c].indexOf("italic")<0){d.Variants.push(j[b].variants[c])}}d.Display=a._createFontDisplay(d,a);g[d.Name]=d}},_addGoogleFonts:function(){var a=this;for(var b=0;b<h.length;b++){if(h[b].family.substring(0,5)!="Slabo"){var d={};d.Variants=[];d.Name=h[b].family;d.Cat=h[b].category;d.Type="Google Font";for(var c=0;c<h[b].variants.length;c++){if(h[b].variants[c].indexOf("italic")<0){d.Variants.push(h[b].variants[c])}}a._addFontLink(d.Name,"normal");d.Display=a._createFontDisplay(d,a);g[d.Name]=d}}},_buildFontLists:function(){var a=this;if(g==null){g={};f.getJSON(lws_ajax_url,{action:"lws_adminpanel_googlefontlist"},function(b){if(null==b){console.log("Font ressource error.")}else{if(0==b){console.log("Ajax action not found.")}else{h=b.items;a._addGoogleFonts()}}}).fail(function(c,b,d){console.log("Ajax failed with status "+b+", error: "+d)});f.getJSON(lws_ajax_url,{action:"lws_adminpanel_standardfontlist"},function(b){if(null==b){console.log("Font ressource error.")}else{if(0==b){console.log("Ajax action not found.")}else{j=b.items;a._addStandardFonts()}}}).fail(function(c,b,d){console.log("Ajax failed with status "+b+", error: "+d)});i=[];if(localStorage.getItem("lws-favouriteFonts")){i=lwsBase64.toObj(localStorage.getItem("lws-favouriteFonts"))}}}})})(jQuery);jQuery(function(b){b(document).click(function(a){if(b(a.target).closest(".lwss-fontselect-popup").length==0){b(".lwss-fontselect-popup").hide()}});b(document).keyup(function(a){if((a.keyCode||a.which||a.charCode||0)===27){b(".lwss-fontselect-popup").hide()}})});